# 飲食店住所→緯度経度の変換方針

このアプリの「飲食店」タブでは、CSV に緯度経度が含まれていないため、**外部ジオコーディング API を呼ばず**に位置を推定しています。主な方針は以下の通りです。

## 1. 駅名 + 距離からの推定
CSV の「駅からの距離」列には `○○駅 350m` / `○○駅 1.2km` のような記述が入っています。
この値を利用して以下の手順で推定座標を作ります。

1. **駅名の正規化**
   - 「駅」や括弧書きを除去し、空白を詰めて駅名キーに変換します。
   - 例: `吹田（ＪＲ）駅 298m` → `吹田`
2. **駅名から基準座標を取得**
   - アプリ内に定義済みの駅リスト（鉄道路線オーバーレイと同じ座標）から一致する駅を探します。
3. **距離の解析**
   - `m` / `km` をメートルに正規化します。
4. **方位の分散**
   - 同じ駅・距離でも点が重ならないよう、店名＋住所を元にハッシュ化した角度を使い、
     円周方向へ分散させます。
5. **緯度経度オフセット**
   - 駅座標から距離分だけ緯度経度をオフセットして最終座標を算出します。

この方式は「駅中心からの距離」に基づく**簡易推定**であり、正確な住所位置ではありませんが、
駅周辺への可視化という目的に合うように設計されています。

## 2. 駅が取得できない場合のフォールバック
駅名が見つからない場合は、**市域の重心**を代替位置として使用します。

- 住所文字列に含まれる市名（吹田市 / 豊中市）を検出
- 対応する市区町村境界ポリゴンから重心を計算
- 市域の中心点としてプロット

これにより、駅名が取得できない店舗でも「市域内に存在する」ことが地図上で把握できます。

## 3. 外部 API を使わない理由
- フロントエンドのみで完結する構成を維持するため
- API キー管理や利用制限の影響を避けるため
- サンプル可視化としての軽量性を優先するため

## 今後の拡張案
より高精度な位置表示が必要な場合は、以下の方法が考えられます。

- 住所をバッチジオコーディングして緯度経度を CSV に追加
- Nominatim / Google Maps API などのジオコーディングサービスをバックエンド経由で利用
- 駅座標の精度向上（より詳細な駅リストや路線データの追加）
